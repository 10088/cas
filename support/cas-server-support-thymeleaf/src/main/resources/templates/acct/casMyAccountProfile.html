<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link href="../../static/css/cas.css" rel="stylesheet" th:remove="tag"/>
</head>

<body id="cas">
<main role="main" class="container mt-3 mb-3">
    <div layout:fragment="content">
        <script type="text/javascript">
            function jqueryReady() {
                $('#attributesTable').DataTable();
                $('#applicationsTable').DataTable();
            }

            function showPanel(element) {
                $('div.profile-content').hide();
                $(element).show();
            }
        </script>

        <div class="mdc-card card w-lg-100 p-4" style="min-height: 360px">
            <table>
                <tr>
                    <td style="position: fixed;">
                        <div>
                            <div class="mdc-drawer__header">
                                <h3 class="mdc-drawer__title" th:text="${authentication.principal.id}">Username</h3>
                                <h6 class="mdc-drawer__subtitle"
                                    th:if="${authentication.principal.attributes['displayName'] != null}"
                                    th:text="${authentication.principal.attributes['displayName'][0]}">Display Name</h6>
                                <h6 class="mdc-drawer__subtitle"
                                    th:if="${authentication.principal.attributes['email'] != null}"
                                    th:text="${authentication.principal.attributes['email'][0]}">Display Name</h6>
                            </div>
                            <div class="mdc-drawer__content">
                                <nav class="mdc-list">
                                    <a class="mdc-list-item list-group-item list-group-item-action"
                                       onclick="showPanel('#divOverview');"
                                       href="#">
                                        <i class="mdi mdi-form-textbox-password fa fa-key"></i>&nbsp;
                                        <span class="mdc-list-item__text">Overview</span>
                                    </a>
                                    <a class="mdc-list-item list-group-item list-group-item-action"
                                       onclick="showPanel('#divAttributes');"
                                       href="#">
                                        <i class="mdi mdi-account-details fa fa-key"></i>&nbsp;
                                        <span class="mdc-list-item__text">Attributes</span>
                                    </a>
                                    <a class="mdc-list-item list-group-item list-group-item-action"
                                       th:if="${authorizedServices}"
                                       onclick="showPanel('#divApplications');"
                                       href="#">
                                        <i class="mdi mdi-apps fa fa-key"></i>&nbsp;
                                        <span class="mdc-list-item__text">Applications</span>
                                    </a>
                                    <hr align="left" width="85%">
                                    <form method="post" id="fmChangePsw" name="fmChangePsw">
                                        <a class="mdc-list-item list-group-item list-group-item-action"
                                           th:if="${passwordManagementEnabled != null && passwordManagementEnabled}"
                                           aria-describedby="tooltip-logout"
                                           onclick="document.forms.fmChangePsw.submit()"
                                           href="#">
                                            <i class="mdi mdi-form-textbox-password fa fa-key"></i>&nbsp;
                                            <span class="mdc-list-item__text">Change Password</span>
                                        </a>
                                        <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
                                        <input type="hidden" name="_eventId" value="resetPassword"/>
                                    </form>

                                    <a class="mdc-list-item list-group-item list-group-item-action" th:href="@{/logout}">
                                        <i class="mdi mdi-logout-variant fa fa-key"></i>&nbsp;
                                        <span class="mdc-list-item__text">Logout</span>
                                    </a>
                                </nav>
                            </div>
                        </div>
                    </td>
                    <td width="75%">
                        <div id="divOverview" class="profile-content p-1 text-justify">
                            <h2>
                                <i class="mdi mdi-door-open fas fa-door-open"></i>
                                <span>Hello, <span th:text="${authentication.principal.id}"></span>!</span>
                            </h2>
                            <p th:utext="#{screen.account.success(${authentication.principal.id})}">You,
                                <strong>username</strong>, have successfully logged into the Central Authentication Service.</p>
                            <p th:utext="#{screen.account.security}">
                                When you are finished, for security reasons, please <a href="logout">log out</a> and exit your web browser.
                            </p>
                        </div>

                        <div class="profile-content w-100 mdc-data-table table-responsive"
                             style="display: none; border-width: 0px;"
                             id="divApplications">
                            <table id="applicationsTable" class="mdc-data-table__table table table-striped"
                                   style="white-space: unset; border:none;">
                                <thead>
                                <tr class="mdc-data-table__header-row">
                                    <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Service</th>
                                    <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Description</th>
                                </tr>
                                </thead>
                                <tbody class="mdc-data-table__content">

                                <tr th:each="service : ${authorizedServices}" class="mdc-data-table__row">
                                    <td class="mdc-data-table__cell">
                                        <a th:id="${'service' + service.id}" th:title="${service.name}" th:alt="${service.description}" th:utext="${service.name}"/>

                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            let serviceId = /*[[${service.serviceId}]]*/;
                                            if (isValidURL(serviceId)) {
                                                let id = /*[[${'service' + service.id}]]*/;
                                                $(`a#${id}`).attr("href", serviceId);
                                            }
                                            /*]]>*/
                                        </script>
                                    </td>
                                    <td class="mdc-data-table__cell">
                                        <span th:utext="${service.description}"/>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>


                        <div class="profile-content w-100 mdc-data-table table-responsive"
                             style="display: none; border:none;"
                             id="divAttributes">
                            <table id="attributesTable" class="table table-striped" style="white-space: unset">
                                <thead>
                                <tr class="mdc-data-table__header-row">
                                    <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Attribute</th>
                                    <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Value(s)</th>
                                </tr>
                                </thead>
                                <tbody class="mdc-data-table__content">
                                <tr th:each="attribute : ${authentication.principal.attributes}" class="mdc-data-table__row">
                                    <td class="mdc-data-table__cell"><code><kbd th:utext="${attribute.key}"/></code></td>
                                    <td class="mdc-data-table__cell">
                                        <code><kbd th:utext="${#strings.abbreviate(attribute.value, 80)}"/></code>
                                    </td>
                                </tr>
                                <tr th:each="attribute : ${authentication.attributes}" class="mdc-data-table__row">
                                    <td class="mdc-data-table__cell"><code><kbd th:utext="${attribute.key}"/></code></td>
                                    <td class="mdc-data-table__cell">
                                        <code><kbd th:utext="${#strings.abbreviate(attribute.value, 80)}"/></code>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <div id="tooltip-logout" class="mdc-tooltip" role="tooltip" aria-hidden="true">
            <div class="mdc-tooltip__surface mdc-tooltip__surface-animation" th:text="#{screen.account.tooltip.logout}">
                This operation forces a logout.
            </div>
        </div>
        
    </div>
</main>
</body>
</html>
