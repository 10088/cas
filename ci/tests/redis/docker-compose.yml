version: "3"

services:
  master:
    image: bitnami/redis:${REDIS_VERSION}
    container_name: redis_server_master
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    ports:
      - 6379:6379

  replica_1:
    image: bitnami/redis:${REDIS_VERSION}
    container_name: redis_server_replica_1
    command: redis-server --slaveof master 6379
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    ports:
      - 6380:6379
    depends_on:
      - master

  replica_2:
    image: bitnami/redis:${REDIS_VERSION}
    container_name: redis_server_replica_2
    command: redis-server --slaveof master 6379
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    ports:
      - 6381:6379
    depends_on:
      - master

  sentinel_1:
    image: bitnami/redis-sentinel:${REDIS_VERSION}
    container_name: redis_sentinel_1
    ports:
      - 26379:26379
    environment:
      - MASTER_NAME=mymaster
      - QUORUM=2
      - MASTER=master
    depends_on:
      - master

  sentinel_2:
    image: bitnami/redis-sentinel:${REDIS_VERSION}
    container_name: redis_sentinel_2
    ports:
      - 26380:26379
    environment:
      - MASTER_NAME=mymaster
      - QUORUM=2
      - MASTER=master
    depends_on:
      - master

  sentinel_3:
    image: bitnami/redis-sentinel:${REDIS_VERSION}
    container_name: redis_sentinel_3
    ports:
      - 26381:26379
    environment:
      - MASTER_NAME=mymaster
      - QUORUM=2
      - MASTER=master
    depends_on:
      - master
